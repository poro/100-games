<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>055 - Reaction Time ⚡</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            user-select: none;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #ffd93d;
        }
        .game-area {
            width: 90vw;
            max-width: 600px;
            height: 400px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
            overflow: hidden;
        }
        .game-area.waiting {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
        }
        .game-area.ready {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }
        .game-area.result {
            background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
        }
        .game-area.early {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        .game-text {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            padding: 20px;
        }
        .reaction-time {
            font-size: 5rem;
            font-weight: bold;
            margin: 20px 0;
        }
        .stats-container {
            display: flex;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 15px 25px;
            border-radius: 15px;
            text-align: center;
            min-width: 120px;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #64ffda;
        }
        .stat-label {
            color: #a0a0a0;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        .attempts {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        .attempt {
            background: rgba(0,0,0,0.3);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        .attempt.best {
            background: rgba(100, 255, 218, 0.2);
            color: #64ffda;
        }
        .btn {
            background: linear-gradient(135deg, #e94560 0%, #0f3460 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
        }
        .rank-display {
            font-size: 1.2rem;
            margin: 15px 0;
        }
        .rank {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        .rank.legendary { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .rank.excellent { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .rank.good { background: linear-gradient(135deg, #3498db, #2980b9); }
        .rank.average { background: linear-gradient(135deg, #f1c40f, #f39c12); }
        .rank.slow { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .instructions {
            color: #a0a0a0;
            text-align: center;
            margin-bottom: 20px;
            max-width: 400px;
        }
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            animation: ripple 0.6s ease-out;
            pointer-events: none;
        }
        @keyframes ripple {
            from {
                transform: scale(0);
                opacity: 1;
            }
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <h1>⚡ Reaction Time</h1>
    <p class="instructions">Wait for green, then tap as fast as you can!</p>

    <div class="game-area waiting" id="gameArea">
        <div class="game-text" id="gameText">Click to Start</div>
        <div class="reaction-time" id="reactionTime" style="display: none;"></div>
    </div>

    <div class="rank-display" id="rankDisplay"></div>

    <div class="stats-container">
        <div class="stat-box">
            <div class="stat-value" id="bestTime">-</div>
            <div class="stat-label">Best Time</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="avgTime">-</div>
            <div class="stat-label">Average</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="attemptCount">0</div>
            <div class="stat-label">Attempts</div>
        </div>
    </div>

    <div class="attempts" id="attempts"></div>

    <script>
        const gameArea = document.getElementById('gameArea');
        const gameText = document.getElementById('gameText');
        const reactionTimeDisplay = document.getElementById('reactionTime');
        const rankDisplay = document.getElementById('rankDisplay');
        const attemptsContainer = document.getElementById('attempts');
        const bestTimeDisplay = document.getElementById('bestTime');
        const avgTimeDisplay = document.getElementById('avgTime');
        const attemptCountDisplay = document.getElementById('attemptCount');

        let state = 'idle'; // idle, waiting, ready, result
        let startTime = 0;
        let timeout = null;
        let attempts = [];
        let bestTime = parseInt(localStorage.getItem('reactionBestTime')) || Infinity;

        function getRank(time) {
            if (time < 150) return { name: 'Legendary', class: 'legendary' };
            if (time < 200) return { name: 'Excellent', class: 'excellent' };
            if (time < 250) return { name: 'Good', class: 'good' };
            if (time < 350) return { name: 'Average', class: 'average' };
            return { name: 'Slow', class: 'slow' };
        }

        function updateStats() {
            attemptCountDisplay.textContent = attempts.length;

            if (attempts.length > 0) {
                const validAttempts = attempts.filter(a => a > 0);
                if (validAttempts.length > 0) {
                    const avg = Math.round(validAttempts.reduce((a, b) => a + b, 0) / validAttempts.length);
                    avgTimeDisplay.textContent = avg + 'ms';
                }
            }

            if (bestTime !== Infinity) {
                bestTimeDisplay.textContent = bestTime + 'ms';
            }
        }

        function showAttempts() {
            attemptsContainer.innerHTML = '';
            const recentAttempts = attempts.slice(-10);
            recentAttempts.forEach((time, i) => {
                const el = document.createElement('span');
                el.className = 'attempt';
                if (time === bestTime) el.classList.add('best');
                el.textContent = time > 0 ? time + 'ms' : 'Too early!';
                attemptsContainer.appendChild(el);
            });
        }

        function createRipple(e) {
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            const rect = gameArea.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.style.width = ripple.style.height = '50px';
            gameArea.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        }

        function startWaiting() {
            state = 'waiting';
            gameArea.className = 'game-area waiting';
            gameText.textContent = 'Wait for green...';
            reactionTimeDisplay.style.display = 'none';
            rankDisplay.innerHTML = '';

            // Random delay between 1.5 and 4 seconds
            const delay = 1500 + Math.random() * 2500;
            timeout = setTimeout(() => {
                if (state === 'waiting') {
                    state = 'ready';
                    startTime = Date.now();
                    gameArea.className = 'game-area ready';
                    gameText.textContent = 'TAP NOW!';
                }
            }, delay);
        }

        function tooEarly() {
            state = 'result';
            clearTimeout(timeout);
            gameArea.className = 'game-area early';
            gameText.textContent = 'Too early!';
            reactionTimeDisplay.textContent = '❌';
            reactionTimeDisplay.style.display = 'block';
            attempts.push(-1);
            showAttempts();
            updateStats();

            setTimeout(() => {
                gameText.textContent += '\nClick to try again';
            }, 500);
        }

        function recordReaction() {
            const reactionTime = Date.now() - startTime;
            state = 'result';
            gameArea.className = 'game-area result';
            gameText.textContent = 'Your reaction time:';
            reactionTimeDisplay.textContent = reactionTime + 'ms';
            reactionTimeDisplay.style.display = 'block';

            // Update best time
            if (reactionTime < bestTime) {
                bestTime = reactionTime;
                localStorage.setItem('reactionBestTime', bestTime);
            }

            attempts.push(reactionTime);

            // Show rank
            const rank = getRank(reactionTime);
            rankDisplay.innerHTML = `<span class="rank ${rank.class}">${rank.name}</span>`;

            showAttempts();
            updateStats();

            setTimeout(() => {
                gameText.textContent += '\nClick to try again';
            }, 500);
        }

        gameArea.addEventListener('click', (e) => {
            createRipple(e);

            switch (state) {
                case 'idle':
                case 'result':
                    startWaiting();
                    break;
                case 'waiting':
                    tooEarly();
                    break;
                case 'ready':
                    recordReaction();
                    break;
            }
        });

        // Touch support
        gameArea.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            createRipple(touch);

            switch (state) {
                case 'idle':
                case 'result':
                    startWaiting();
                    break;
                case 'waiting':
                    tooEarly();
                    break;
                case 'ready':
                    recordReaction();
                    break;
            }
        }, { passive: false });

        // Initialize
        if (bestTime !== Infinity) {
            bestTimeDisplay.textContent = bestTime + 'ms';
        }
    </script>
</body>
</html>
