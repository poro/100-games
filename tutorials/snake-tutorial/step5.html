<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake - Step 5: Food and Growing</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #1a1a2e;
            font-family: Arial, sans-serif;
            color: #eee;
        }
        canvas {
            background-color: #16213e;
            border: 4px solid #e94560;
            border-radius: 8px;
        }
        .score {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .instructions {
            margin-top: 20px;
            text-align: center;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="score">Score: <span id="scoreDisplay">0</span></div>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div class="instructions">
        Use Arrow Keys or WASD to control the snake<br>
        Eat the red food to grow!
    </div>

    <script>
        // ============================================================
        // STEP 5: FOOD AND GROWING
        // ============================================================
        // Now we add the core gameplay: food appears on the screen,
        // and when the snake eats it, it grows longer!
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        
        // ============================================================
        // GAME CONSTANTS
        // ============================================================
        const GRID_SIZE = 20;
        const GRID_WIDTH = canvas.width / GRID_SIZE;
        const GRID_HEIGHT = canvas.height / GRID_SIZE;
        const GAME_SPEED = 150;
        
        // ============================================================
        // GAME STATE
        // ============================================================
        let snake = [
            { x: 10, y: 10 },
            { x: 9, y: 10 },
            { x: 8, y: 10 },
            { x: 7, y: 10 },
        ];
        
        let direction = { x: 1, y: 0 };
        let nextDirection = { x: 1, y: 0 };
        
        // NEW: Food position
        // Food is just an {x, y} object like snake segments
        let food = { x: 15, y: 10 };
        
        // NEW: Score tracking
        let score = 0;
        
        // ============================================================
        // NEW: FOOD FUNCTIONS
        // ============================================================
        
        /**
         * Generates a random position for food.
         * The food must not appear on the snake!
         * 
         * This function demonstrates a common game dev pattern:
         * Keep generating random positions until we find a valid one.
         */
        function spawnFood() {
            let newFood;
            let isOnSnake;
            
            // Keep trying until we find a valid position
            do {
                // Generate random grid coordinates
                // Math.random() gives 0 to 0.999...
                // Multiply by grid size, floor it to get integer
                newFood = {
                    x: Math.floor(Math.random() * GRID_WIDTH),
                    y: Math.floor(Math.random() * GRID_HEIGHT)
                };
                
                // Check if this position is on the snake
                // some() returns true if ANY element passes the test
                isOnSnake = snake.some(segment => 
                    segment.x === newFood.x && segment.y === newFood.y
                );
                
                // If it's on the snake, the loop continues
            } while (isOnSnake);
            
            // We found a valid position!
            food = newFood;
            console.log('Food spawned at:', food);
        }
        
        /**
         * Checks if the snake's head is on the food.
         * Returns true if the snake is eating.
         */
        function isEatingFood() {
            const head = snake[0];
            return head.x === food.x && head.y === food.y;
        }
        
        /**
         * Draws the food on the canvas.
         * We make it look different from the snake - red and round-ish.
         */
        function drawFood() {
            const pixelX = food.x * GRID_SIZE;
            const pixelY = food.y * GRID_SIZE;
            
            // Draw as a circle (apple-like)
            ctx.fillStyle = '#e94560';  // Red color
            ctx.beginPath();
            // arc(centerX, centerY, radius, startAngle, endAngle)
            // We offset by half the grid size to center the circle
            ctx.arc(
                pixelX + GRID_SIZE / 2,  // Center X
                pixelY + GRID_SIZE / 2,  // Center Y
                GRID_SIZE / 2 - 2,       // Radius (slightly smaller than cell)
                0,                        // Start angle (0 radians)
                Math.PI * 2              // End angle (full circle = 2Ï€ radians)
            );
            ctx.fill();
            
            // Optional: add a little highlight to make it look 3D
            ctx.fillStyle = '#ff6b6b';
            ctx.beginPath();
            ctx.arc(
                pixelX + GRID_SIZE / 2 - 3,
                pixelY + GRID_SIZE / 2 - 3,
                3,
                0,
                Math.PI * 2
            );
            ctx.fill();
        }
        
        // ============================================================
        // KEYBOARD INPUT (Same as Step 4)
        // ============================================================
        
        function handleKeyPress(event) {
            switch (event.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    if (direction.y !== 1) nextDirection = { x: 0, y: -1 };
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    if (direction.y !== -1) nextDirection = { x: 0, y: 1 };
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    if (direction.x !== 1) nextDirection = { x: -1, y: 0 };
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    if (direction.x !== -1) nextDirection = { x: 1, y: 0 };
                    break;
            }
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {
                event.preventDefault();
            }
        }
        
        document.addEventListener('keydown', handleKeyPress);
        
        // ============================================================
        // DRAWING FUNCTIONS
        // ============================================================
        
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        function drawCell(gridX, gridY, color) {
            const pixelX = gridX * GRID_SIZE;
            const pixelY = gridY * GRID_SIZE;
            ctx.fillStyle = color;
            ctx.fillRect(pixelX, pixelY, GRID_SIZE, GRID_SIZE);
            ctx.strokeStyle = '#16213e';
            ctx.lineWidth = 2;
            ctx.strokeRect(pixelX, pixelY, GRID_SIZE, GRID_SIZE);
        }
        
        function drawSnake() {
            snake.forEach((segment, index) => {
                const color = index === 0 ? '#4ecca3' : '#3aa389';
                drawCell(segment.x, segment.y, color);
            });
        }
        
        // ============================================================
        // UPDATE FUNCTIONS (Modified for food)
        // ============================================================
        
        /**
         * Modified moveSnake - now handles eating!
         * If the snake is about to eat food, we DON'T remove the tail.
         * This makes the snake grow by one segment.
         */
        function moveSnake() {
            const head = snake[0];
            const newHead = {
                x: head.x + direction.x,
                y: head.y + direction.y
            };
            
            // Add the new head
            snake.unshift(newHead);
            
            // Check if we're eating food
            if (isEatingFood()) {
                // We ATE the food!
                // 1. Increase score
                score += 10;
                scoreDisplay.textContent = score;
                
                // 2. Spawn new food
                spawnFood();
                
                // 3. DON'T remove the tail - this makes us grow!
                console.log('Nom! Snake length:', snake.length);
            } else {
                // Not eating - remove tail to maintain length
                snake.pop();
            }
        }
        
        function update() {
            direction = nextDirection;
            moveSnake();
        }
        
        function draw() {
            clearCanvas();
            drawFood();    // Draw food first (so snake appears on top)
            drawSnake();
        }
        
        // ============================================================
        // GAME LOOP
        // ============================================================
        
        function gameLoop() {
            update();
            draw();
        }
        
        // ============================================================
        // START THE GAME
        // ============================================================
        
        // Spawn initial food
        spawnFood();
        
        // Initial draw
        draw();
        
        // Start the game loop
        const gameInterval = setInterval(gameLoop, GAME_SPEED);
        
        // ============================================================
        // WHAT WE LEARNED IN THIS STEP:
        // ============================================================
        // 1. Food is just another {x, y} position on the grid
        // 2. Math.random() and Math.floor() for random positions
        // 3. The do-while loop ensures food doesn't spawn on snake
        // 4. array.some() checks if ANY element matches a condition
        // 5. Snake grows by NOT removing the tail when eating
        // 6. ctx.arc() draws circles (for the food)
        // 7. We can update HTML elements from JavaScript (score)
        //
        // NEXT STEP: Collision detection - walls and self!
        // ============================================================
        
        console.log('Step 5 Complete! Eat the red food to grow and score!');
        console.log('The snake still goes through walls - fixing that next!');
    </script>
</body>
</html>
